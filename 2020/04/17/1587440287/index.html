<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="テスト駆動開発から始めるRuby入門 ~ソフトウェア開発の三種の神器を準備する~"><meta name="keywords" content="テスト駆動開発,Ruby"><meta name="author" content="k2works"><meta name="copyright" content="k2works"><title>テスト駆動開発から始めるRuby入門 ~ソフトウェア開発の三種の神器を準備する~ | １つの価値３つの領域 思想と技術</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-48713941-1', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#初めに"><span class="toc-number">1.</span> <span class="toc-text">初めに</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自動化から始めるテスト駆動開発"><span class="toc-number">2.</span> <span class="toc-text">自動化から始めるテスト駆動開発</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#コミットメッセージ"><span class="toc-number">2.1.</span> <span class="toc-text">コミットメッセージ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#パッケージマネージャ"><span class="toc-number">2.2.</span> <span class="toc-text">パッケージマネージャ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#静的コード解析"><span class="toc-number">2.3.</span> <span class="toc-text">静的コード解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#コードフォーマッタ"><span class="toc-number">2.4.</span> <span class="toc-text">コードフォーマッタ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#コードカバレッジ"><span class="toc-number">2.5.</span> <span class="toc-text">コードカバレッジ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#タスクランナー"><span class="toc-number">2.6.</span> <span class="toc-text">タスクランナー</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#タスクの自動化"><span class="toc-number">2.7.</span> <span class="toc-text">タスクの自動化</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars1.githubusercontent.com/u/3236312?s=400&amp;u=e1bde5f87a640284db5e7bde55b7ecb2aa0f1eac&amp;v=4"></div><div class="author-info__name text-center">k2works</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">28</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">17</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">１つの価値３つの領域 思想と技術</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">テスト駆動開発から始めるRuby入門 ~ソフトウェア開発の三種の神器を準備する~</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-17</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%8A%80%E8%A1%93/">技術</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%8A%80%E8%A1%93/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0/">プログラミング</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="初めに"><a href="#初めに" class="headerlink" title="初めに"></a>初めに</h2><p>この記事は <a href="https://k2works.github.io/2020/04/16/1587009564/">テスト駆動開発から始める Ruby 入門 - 2 時間で TDD とリファクタリングのエッセンスを体験する -</a> の続編です。</p>
<a id="more"></a>

<h2 id="自動化から始めるテスト駆動開発"><a href="#自動化から始めるテスト駆動開発" class="headerlink" title="自動化から始めるテスト駆動開発"></a>自動化から始めるテスト駆動開発</h2><p>エピソード 1 ではテスト駆動開発のゴールが <strong>動作するきれいなコード</strong> であることを学びました。では、良いコードを書き続けるためには何が必要になるでしょうか？それは<a href="https://t-wada.hatenablog.jp/entry/clean-code-that-works" target="_blank" rel="noopener">ソフトウェア開発の三種の神器</a>と呼ばれるものです。</p>
<blockquote>
<p>今日のソフトウェア開発の世界において絶対になければならない 3 つの技術的な柱があります。<br>三本柱と言ったり、三種の神器と言ったりしていますが、それらは</p>
<ul>
<li><p>バージョン管理</p>
</li>
<li><p>テスティング</p>
</li>
<li><p>自動化</p>
</li>
</ul>
<p>の 3 つです。</p>
<p>— <a href="https://t-wada.hatenablog.jp/entry/clean-code-that-works" target="_blank" rel="noopener">https://t-wada.hatenablog.jp/entry/clean-code-that-works</a></p>
</blockquote>
<p><strong>バージョン管理</strong> と <strong>テスティング</strong> に関してはエピソード 1 で触れました。本エピソードでは最後の <strong>自動化</strong> に関しての解説と次のエピソードに備えたセットアップ作業を実施しておきたいと思います。ですがその前に <strong>バージョン管理</strong> で 1 つだけ解説しておきたいことがありますのでそちらから進めて行きたいと思います。</p>
<h3 id="コミットメッセージ"><a href="#コミットメッセージ" class="headerlink" title="コミットメッセージ"></a>コミットメッセージ</h3><p>これまで作業の区切りにごとにレポジトリにコミットしていましたがその際に以下のような書式でメッセージを書いていました。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">'refactor: メソッドの抽出'</span></span><br></pre></td></tr></table></figure>

<p>この書式は<br><a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#type" target="_blank" rel="noopener">Angular ルール</a>に従っています。具体的には、それぞれのコミットメッセージはヘッダ、ボディ、フッタで構成されています。ヘッダはタイプ、スコープ、タイトルというフォーマットで構成されています。</p>
<pre><code>&lt;タイプ&gt;(&lt;スコープ&gt;): &lt;タイトル&gt;
&lt;空行&gt;
&lt;ボディ&gt;
&lt;空行&gt;
&lt;フッタ&gt;</code></pre><p>ヘッダは必須です。 ヘッダのスコープは任意です。 コミットメッセージの長さは 50 文字までにしてください。</p>
<p>(そうすることでその他の Git ツールと同様に GitHub 上で読みやすくなります。)</p>
<p>コミットのタイプは次を用いて下さい。</p>
<ul>
<li><p>feat: A new feature (新しい機能)</p>
</li>
<li><p>fix: A bug fix (バグ修正)</p>
</li>
<li><p>docs: Documentation only changes (ドキュメント変更のみ)</p>
</li>
<li><p>style: Changes that do not affect the meaning of the code<br>(white-space, formatting, missing semi-colons, etc) (コードに影響を与えない変更)</p>
</li>
<li><p>refactor: A code change that neither fixes a bug nor adds a feature<br>(機能追加でもバグ修正でもないコード変更)</p>
</li>
<li><p>perf: A code change that improves performance (パフォーマンスを改善するコード変更)</p>
</li>
<li><p>test: Adding missing or correcting existing tests<br>(存在しないテストの追加、または既存のテストの修正)</p>
</li>
<li><p>chore: Changes to the build process or auxiliary tools and libraries<br>such as documentation generation<br>(ドキュメント生成のような、補助ツールやライブラリやビルドプロセスの変更)</p>
</li>
</ul>
<p>コミットメッセージにつけるプリフィックスに関しては <a href="https://qiita.com/numanomanu/items/45dd285b286a1f7280ed" target="_blank" rel="noopener">【今日からできる】コミットメッセージに 「プレフィックス」をつけるだけで、開発効率が上がった話</a>を参照ください。</p>
<h3 id="パッケージマネージャ"><a href="#パッケージマネージャ" class="headerlink" title="パッケージマネージャ"></a>パッケージマネージャ</h3><p>では <strong>自動化</strong> の準備に入りたいのですがそのためにはいくつかの外部プログラムを利用する必要があります。そのためのツールが <strong>RubyGems</strong> です。</p>
<blockquote>
<p>RubyGems とは、Ruby で記述されたサードパーティ製のライブラリを管理するためのツールで、RubyGems で扱うライブラリを gem パッケージと呼びます。</p>
<p>— かんたん Ruby</p>
</blockquote>
<p><strong>RubyGems</strong> はすでに何度か使っています。例えばエピソード 1 の初めの <code>minitest-reporters</code><br>のインストールなどです。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem install minitest-reporters</span><br></pre></td></tr></table></figure>

<p>では、これからもこのようにして必要な外部プログラムを一つ一つインストールしていくのでしょうか？また、開発用マシンを変えた時にも同じことを繰り返さないといけないのでしょうか？面倒ですよね。そのような面倒なことをしないで済む仕組みが Ruby には用意されています。それが <strong>Bundler</strong> です。</p>
<blockquote>
<p>Bundler とは、作成したアプリケーションがどの gem パッケージに依存しているか、そしてインストールしているバージョンはいくつかという情報を管理するための gem パッケージです。</p>
<p>— かんたん Ruby</p>
</blockquote>
<p><strong>Bundler</strong> をインストールして gem パッケージを束ねましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gem install bundler</span><br><span class="line">$ bundle init</span><br></pre></td></tr></table></figure>

<p><code>Gemfile</code> が作成されます。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"></span><br><span class="line">source <span class="string">"https://rubygems.org"</span></span><br><span class="line"></span><br><span class="line">git_source(<span class="symbol">:github</span>) &#123;<span class="params">|repo_name|</span> <span class="string">"https://github.com/<span class="subst">#&#123;repo_name&#125;</span>"</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># gem "rails"</span></span><br></pre></td></tr></table></figure>

<p><code># gem &quot;rails&quot;</code> の部分を以下の様に書き換えます。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"></span><br><span class="line">source <span class="string">"https://rubygems.org"</span></span><br><span class="line"></span><br><span class="line">git_source(<span class="symbol">:github</span>) &#123;<span class="params">|repo_name|</span> <span class="string">"https://github.com/<span class="subst">#&#123;repo_name&#125;</span>"</span> &#125;</span><br><span class="line"></span><br><span class="line">gem <span class="string">'rubocop'</span>, <span class="symbol">require:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>書き換えたら <code>bundle install</code> で gem パッケージをインストールします。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ bundle install</span><br><span class="line">Fetching gem metadata from https://rubygems.org/....................</span><br><span class="line">Resolving dependencies...</span><br><span class="line">Using ast 2.4.0</span><br><span class="line">Using bundler 2.1.4</span><br><span class="line">Using jaro_winkler 1.5.4</span><br><span class="line">Using parallel 1.19.1</span><br><span class="line">Fetching parser 2.7.0.2</span><br><span class="line">Installing parser 2.7.0.2</span><br><span class="line">Using rainbow 3.0.0</span><br><span class="line">Using ruby-progressbar 1.10.1</span><br><span class="line">Fetching unicode-display_width 1.6.1</span><br><span class="line">Installing unicode-display_width 1.6.1</span><br><span class="line">Fetching rubocop 0.79.0</span><br><span class="line">Installing rubocop 0.79.0</span><br><span class="line">Bundle complete! 1 Gemfile dependency, 9 gems now installed.</span><br><span class="line">Use `bundle info [gemname]` to see <span class="built_in">where</span> a bundled gem is installed.</span><br></pre></td></tr></table></figure>

<p>これで次の準備ができました。</p>
<h3 id="静的コード解析"><a href="#静的コード解析" class="headerlink" title="静的コード解析"></a>静的コード解析</h3><p>良いコードを書き続けるためにはコードの品質を維持していく必要があります。エピソード 1 では <strong>テスト駆動開発</strong> によりプログラムを動かしながら品質の改善していきました。出来上がったコードに対する品質チェックの方法として <strong>静的コード解析</strong> があります。Ruby 用 <strong>静的コード解析</strong> ツール<a href="https://github.com/rubocop-hq/rubocop" target="_blank" rel="noopener">RuboCop</a> を使って確認してみましょう。プログラムは先程 <strong>Bundler</strong> を使ってインストールしたので以下のコマンドを実行します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> $ rubocop</span><br><span class="line">Inspecting 5 files</span><br><span class="line">CCCWW</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line">Gemfile:3:8: C: Style/StringLiterals: Prefer single-quoted strings when you don<span class="string">'t need string interpolation or special symbols.</span></span><br><span class="line"><span class="string">source "https://rubygems.org"</span></span><br><span class="line"><span class="string">       ^^^^^^^^^^^^^^^^^^^^^^</span></span><br><span class="line"><span class="string">Gemfile:5:21: C: Layout/SpaceInsideBlockBraces: Space between &#123; and | missing.</span></span><br><span class="line"><span class="string">git_source(:github) &#123;|repo_name| "https://github.com/#&#123;repo_name&#125;" &#125;</span></span><br><span class="line"><span class="string">                    ^^</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>なにかいろいろ出てきましたね。RuboCop の詳細に関しては <a href="https://qiita.com/tomohiii/items/1a17018b5a48b8284a8b" target="_blank" rel="noopener">RuboCop is 何？</a>を参照ください。<code>--lint</code> オプションをつけて実施してみましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop --lint</span><br><span class="line">Inspecting 5 files</span><br><span class="line">...W.</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>/fizz_buzz_test.rb:109:7: : Parenthesize the param %w[2 4 13 3 1 10].sort &#123; |a, b| a.to_i &lt;=&gt; b.to_i &#125; to make sure that the block will be associated with the %w[2 4 13 3 1 10].sort method call.</span><br><span class="line">      assert_equal %w[1 2 3 4 10 13], ...</span><br><span class="line">      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line"><span class="built_in">test</span>/fizz_buzz_test.rb:111:7: W: Lint/AmbiguousBlockAssociation: Parenthesize the param %w[2 4 13 3 1 10].sort &#123; |b, a| a.to_i &lt;=&gt; b.to_i &#125; to make sure that the block will be associated with the %w[2 4 13 3 1 10].sort method call.</span><br><span class="line">      assert_equal %w[13 10 4 3 2 1], ...</span><br><span class="line">      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line"></span><br><span class="line">5 files inspected, 2 offenses detected</span><br></pre></td></tr></table></figure>

<p>また何やら出てきましたね。 <a href="https://rubocop.readthedocs.io/en/latest/cops_lint/#lintambiguousblockassociation" target="_blank" rel="noopener">W:Lint/AmbiguousBlockAssociation</a>のメッセージを調べたところ、<code>fizz_buzz_test.rb</code> の以下の学習用テストコードは書き方がよろしくないようですね。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">test_</span>指定した評価式で並び変えた配列を返す</span></span><br><span class="line">        assert_equal <span class="string">%w[1 10 13 2 3 4]</span>, <span class="string">%w[2 4 13 3 1 10]</span>.sort</span><br><span class="line">        assert_equal <span class="string">%w[1 2 3 4 10 13]</span>,</span><br><span class="line">                     <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|a, b|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line">        assert_equal <span class="string">%w[13 10 4 3 2 1]</span>,</span><br><span class="line">                     <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|b, a|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>説明用変数の導入</strong> を使ってテストコードをリファクタリングしておきましょう。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>指定した評価式で並び変えた配列を返す</span></span><br><span class="line">      result1 = <span class="string">%w[2 4 13 3 1 10]</span>.sort</span><br><span class="line">      result2 = <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|a, b|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line">      result3 = <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|b, a|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line"></span><br><span class="line">      assert_equal <span class="string">%w[1 10 13 2 3 4]</span>, result1</span><br><span class="line">      assert_equal <span class="string">%w[1 2 3 4 10 13]</span>, result2</span><br><span class="line">      assert_equal <span class="string">%w[13 10 4 3 2 1]</span>, result3</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>再度確認します。チェックは通りましたね。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop --lint</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">5 files inspected, no offenses detected</span><br></pre></td></tr></table></figure>

<p>テストも実行して壊れていないかも確認しておきます。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ruby <span class="built_in">test</span>/fizz_buzz_test.rb</span><br><span class="line">Started with run options --seed 42058</span><br><span class="line"></span><br><span class="line">  19/19: [=========================================================================] 100% Time: 00:00:00, Time: 00:00:00</span><br><span class="line"></span><br><span class="line">Finished <span class="keyword">in</span> 0.00257s</span><br><span class="line">19 tests, 21 assertions, 0 failures, 0 errors, 0 skips</span><br></pre></td></tr></table></figure>

<p>いちいち調べるのも手間なので自動で修正できるところは修正してもらいましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop --auto-correct</span><br></pre></td></tr></table></figure>

<p>再度確認します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> $ rubocop</span><br><span class="line">Inspecting 5 files</span><br><span class="line">...CC</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>/fizz_buzz_test.rb:15:11: C: Naming/MethodName: Use snake_case <span class="keyword">for</span> method names.</span><br><span class="line">      def test_3を渡したら文字列Fizzを返す</span><br><span class="line">          ^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>まだ、自動修正できなかった部分があるようですね。この部分はチェック対象から外すことにしましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop --auto-gen-config</span><br><span class="line">Added inheritance from `.rubocop_todo.yml` <span class="keyword">in</span> `.rubocop.yml`.</span><br><span class="line">Phase 1 of 2: run Layout/LineLength cop</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">5 files inspected, no offenses detected</span><br><span class="line">Created .rubocop_todo.yml.</span><br><span class="line">Phase 2 of 2: run all cops</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.C.CW</span><br><span class="line"></span><br><span class="line">5 files inspected, 110 offenses detected</span><br><span class="line">Created .rubocop_todo.yml.</span><br></pre></td></tr></table></figure>

<p>生成された <code>.rubocop_todo.yml</code> の以下の部分を変更します。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Offense count: 32</span></span><br><span class="line"><span class="comment"># Configuration parameters: IgnoredPatterns.</span></span><br><span class="line"><span class="comment"># SupportedStyles: snake_case, camelCase</span></span><br><span class="line"><span class="attr">Naming/MethodName:</span></span><br><span class="line">  <span class="attr">EnforcedStyle:</span> <span class="string">snake_case</span></span><br><span class="line">  <span class="attr">Exclude:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"test/fizz_buzz_test.rb"</span></span><br></pre></td></tr></table></figure>

<p>再度チェックを実行します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">5 files inspected, no offenses detected</span><br></pre></td></tr></table></figure>

<p>セットアップができたのでここでコミットしておきましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">'chore: 静的コード解析セットアップ'</span></span><br></pre></td></tr></table></figure>

<h3 id="コードフォーマッタ"><a href="#コードフォーマッタ" class="headerlink" title="コードフォーマッタ"></a>コードフォーマッタ</h3><p>良いコードであるためにはフォーマットも大切な要素です。</p>
<blockquote>
<p>優れたソースコードは「目に優しい」ものでなければいけない。</p>
<p>— リーダブルコード</p>
</blockquote>
<p>Ruby にはいくつかフォーマットアプリケーションはあるのですがここは <code>RuboCop</code> の機能を使って実現することにしましょう。以下のコードのフォーマットをわざと崩してみます。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FizzBuzz</span></span></span><br><span class="line">  MAX_NUMBER = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">generate</span><span class="params">(number)</span></span></span><br><span class="line">          isFizz = number.modulo(<span class="number">3</span>).zero?</span><br><span class="line">    isBuzz = number.modulo(<span class="number">5</span>).zero?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'FizzBuzz'</span> <span class="keyword">if</span> isFizz &amp;&amp; isBuzz</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Fizz'</span> <span class="keyword">if</span> isFizz</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Buzz'</span> <span class="keyword">if</span> isBuzz</span><br><span class="line"></span><br><span class="line">    number.to_s</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">generate_list</span></span></span><br><span class="line">    <span class="comment"># 1から最大値までのFizzBuzz配列を1発で作る</span></span><br><span class="line">    (<span class="number">1</span>..MAX_NUMBER).map &#123; <span class="params">|n|</span> generate(n) &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>スタイルオプションをつけてチェックしてみます。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop --only Layout</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.C...</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line">lib/fizz_buzz.rb:7:3: C: Layout/IndentationWidth: Use 2 (not 8) spaces <span class="keyword">for</span> indentation.</span><br><span class="line">          isFizz = number.modulo(3).zero?</span><br><span class="line">  ^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:8:5: C: Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    isBuzz = number.modulo(5).zero?</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:10:5: C: Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    <span class="built_in">return</span> <span class="string">'FizzBuzz'</span> <span class="keyword">if</span> isFizz &amp;&amp; isBuzz</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:11:5: C: Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    <span class="built_in">return</span> <span class="string">'Fizz'</span> <span class="keyword">if</span> isFizz</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:12:5: C: Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    <span class="built_in">return</span> <span class="string">'Buzz'</span> <span class="keyword">if</span> isBuzz</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:14:5: C: Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    number.to_s</span><br><span class="line">    ^^^^^^^^^^^</span><br><span class="line"></span><br><span class="line">5 files inspected, 6 offenses detected</span><br></pre></td></tr></table></figure>

<p>編集した部分が <code>Use 2 (not 8) spaces for indentation.</code> と指摘されています。<code>--fix-layout</code> オプションで自動保存しておきましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop --fix-layout</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.C...</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line">lib/fizz_buzz.rb:7:3: C: [Corrected] Layout/IndentationWidth: Use 2 (not 8) spaces <span class="keyword">for</span> indentation.</span><br><span class="line">          isFizz = number.modulo(3).zero?</span><br><span class="line">  ^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:8:5: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    isBuzz = number.modulo(5).zero?</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:8:11: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">          isBuzz = number.modulo(5).zero?</span><br><span class="line">          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:10:5: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    <span class="built_in">return</span> <span class="string">'FizzBuzz'</span> <span class="keyword">if</span> isFizz &amp;&amp; isBuzz</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:10:11: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">          <span class="built_in">return</span> <span class="string">'FizzBuzz'</span> <span class="keyword">if</span> isFizz &amp;&amp; isBuzz</span><br><span class="line">          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:11:5: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    <span class="built_in">return</span> <span class="string">'Fizz'</span> <span class="keyword">if</span> isFizz</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:11:11: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">          <span class="built_in">return</span> <span class="string">'Fizz'</span> <span class="keyword">if</span> isFizz</span><br><span class="line">          ^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:12:5: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    <span class="built_in">return</span> <span class="string">'Buzz'</span> <span class="keyword">if</span> isBuzz</span><br><span class="line">    ^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:12:11: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">          <span class="built_in">return</span> <span class="string">'Buzz'</span> <span class="keyword">if</span> isBuzz</span><br><span class="line">          ^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:14:5: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">    number.to_s</span><br><span class="line">    ^^^^^^^^^^^</span><br><span class="line">lib/fizz_buzz.rb:14:11: C: [Corrected] Layout/IndentationConsistency: Inconsistent indentation detected.</span><br><span class="line">          number.to_s</span><br><span class="line">          ^^^^^^^^^^^</span><br><span class="line"></span><br><span class="line">5 files inspected, 11 offenses detected, 11 offenses corrected</span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FizzBuzz</span></span></span><br><span class="line">  MAX_NUMBER = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">generate</span><span class="params">(number)</span></span></span><br><span class="line">    isFizz = number.modulo(<span class="number">3</span>).zero?</span><br><span class="line">    isBuzz = number.modulo(<span class="number">5</span>).zero?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'FizzBuzz'</span> <span class="keyword">if</span> isFizz &amp;&amp; isBuzz</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Fizz'</span> <span class="keyword">if</span> isFizz</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Buzz'</span> <span class="keyword">if</span> isBuzz</span><br><span class="line"></span><br><span class="line">    number.to_s</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">generate_list</span></span></span><br><span class="line">    <span class="comment"># 1から最大値までのFizzBuzz配列を1発で作る</span></span><br><span class="line">    (<span class="number">1</span>..MAX_NUMBER).map &#123; <span class="params">|n|</span> generate(n) &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rubocop --only Layout</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">5 files inspected, no offenses detected</span><br></pre></td></tr></table></figure>

<p>フォーマットが修正されたことが確認できましたね。ちなみに <code>--auto-correct</code> オプションでもフォーマットをしてくれるので通常はこちらのオプションで問題ないと思います。</p>
<h3 id="コードカバレッジ"><a href="#コードカバレッジ" class="headerlink" title="コードカバレッジ"></a>コードカバレッジ</h3><p>静的コードコード解析による品質の確認はできました。では動的なテストに関してはどうでしょうか？ <strong>コードカバレッジ</strong> を確認する必要あります。</p>
<blockquote>
<p>コード網羅率（コードもうらりつ、英: Code coverage<br>）コードカバレッジは、ソフトウェアテストで用いられる尺度の 1 つである。プログラムのソースコードがテストされた割合を意味する。この場合のテストはコードを見ながら行うもので、ホワイトボックステストに分類される。</p>
<p>— ウィキペディア</p>
</blockquote>
<p>Ruby 用 <strong>コードカバレッジ</strong> 検出プログラムとして <a href="https://github.com/colszowka/simplecov" target="_blank" rel="noopener">SimpleCov</a>を使います。Gemfile に追加して <strong>Bundler</strong> でインストールをしましょう。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"></span><br><span class="line">source <span class="string">'https://rubygems.org'</span></span><br><span class="line"></span><br><span class="line">git_source(<span class="symbol">:github</span>) &#123; <span class="params">|repo_name|</span> <span class="string">"https://github.com/<span class="subst">#&#123;repo_name&#125;</span>"</span> &#125;</span><br><span class="line"></span><br><span class="line">gem <span class="string">'minitest'</span></span><br><span class="line">gem <span class="string">'minitest-reporters'</span></span><br><span class="line">gem <span class="string">'rubocop'</span>, <span class="symbol">require:</span> <span class="literal">false</span></span><br><span class="line">gem <span class="string">'simplecov'</span>, <span class="symbol">require:</span> <span class="literal">false</span>, <span class="symbol">group:</span> <span class="symbol">:test</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ bundle install</span><br><span class="line">Fetching gem metadata from https://rubygems.org/..................</span><br><span class="line">Resolving dependencies...</span><br><span class="line">Fetching ansi 1.5.0</span><br><span class="line">Installing ansi 1.5.0</span><br><span class="line">Using ast 2.4.0</span><br><span class="line">Fetching builder 3.2.4</span><br><span class="line">Installing builder 3.2.4</span><br><span class="line">Using bundler 2.1.4</span><br><span class="line">Using docile 1.3.2</span><br><span class="line">Using jaro_winkler 1.5.4</span><br><span class="line">Using json 2.3.0</span><br><span class="line">Fetching minitest 5.14.0</span><br><span class="line">Installing minitest 5.14.0</span><br><span class="line">Using ruby-progressbar 1.10.1</span><br><span class="line">Fetching minitest-reporters 1.4.2</span><br><span class="line">Installing minitest-reporters 1.4.2</span><br><span class="line">Using parallel 1.19.1</span><br><span class="line">Using parser 2.7.0.2</span><br><span class="line">Using rainbow 3.0.0</span><br><span class="line">Using unicode-display_width 1.6.1</span><br><span class="line">Using rubocop 0.79.0</span><br><span class="line">Using simplecov-html 0.10.2</span><br><span class="line">Using simplecov 0.17.1</span><br><span class="line">Bundle complete! 4 Gemfile dependencies, 17 gems now installed.</span><br><span class="line">Use `bundle info [gemname]` to see <span class="built_in">where</span> a bundled gem is installed.</span><br></pre></td></tr></table></figure>

<p>サイトの説明に従ってテストコードの先頭に以下のコードを追加します。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'simplecov'</span></span><br><span class="line">SimpleCov.start</span><br><span class="line"><span class="keyword">require</span> <span class="string">'minitest/reporters'</span></span><br><span class="line">Minitest::Reporters.use!</span><br><span class="line"><span class="keyword">require</span> <span class="string">'minitest/autorun'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'./lib/fizz_buzz'</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>テストを実施します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ruby <span class="built_in">test</span>/fizz_buzz_test.rb</span><br><span class="line">Started with run options --seed 10538</span><br><span class="line"></span><br><span class="line">  19/19: [===============================] 100% Time: 00:00:00, Time: 00:00:00</span><br><span class="line"></span><br><span class="line">Finished <span class="keyword">in</span> 0.00297s</span><br><span class="line">19 tests, 21 assertions, 0 failures, 0 errors, 0 skips</span><br></pre></td></tr></table></figure>

<p>テスト実行後に <code>coverage</code> というフォルダが作成されます。その中の <code>index.html</code> を開くとカバレッジ状況を確認できます。セットアップが完了したらコミットしておきましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">'chore: コードカバレッジセットアップ'</span></span><br></pre></td></tr></table></figure>

<h3 id="タスクランナー"><a href="#タスクランナー" class="headerlink" title="タスクランナー"></a>タスクランナー</h3><p>ここまででテストの実行、静的コード解析、コードフォーマット、コードカバレッジを実施することができるようになりました。でもコマンドを実行するのにそれぞれコマンドを覚えておくのは面倒ですよね。例えばテストの実行は</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ruby <span class="built_in">test</span>/fizz_buzz_test.rb</span><br><span class="line">Started with run options --seed 21943</span><br><span class="line"></span><br><span class="line">  19/19: [=======================================] 100% Time: 00:00:00, Time: 00:00:00</span><br><span class="line"></span><br><span class="line">Finished <span class="keyword">in</span> 0.00261s</span><br><span class="line">19 tests, 21 assertions, 0 failures, 0 errors, 0 skips</span><br></pre></td></tr></table></figure>

<p>このようにしていました。では静的コードの解析はどうやりましたか？フォーマットはどうやりましたか？調べるのも面倒ですよね。いちいち調べるのが面倒なことは全部 <strong>タスクランナー</strong> にやらせるようにしましょう。</p>
<blockquote>
<p>タスクランナーとは、アプリケーションのビルドなど、一定の手順で行う作業をコマンド一つで実行できるように予めタスクとして定義したものです。</p>
<p>— かんたん Ruby</p>
</blockquote>
<p>Ruby の <strong>タスクランナー</strong> は <code>Rake</code> です。</p>
<blockquote>
<p>Rake は Ruby におけるタスクランナーです。rake コマンドと起点となる Rakefile というタスクを記述するファイルを用意することで、タスクの実行や登録されたタスクの一覧表示を行えます。</p>
<p>— かんたん Ruby</p>
</blockquote>
<p>早速、テストタスクから作成しましょう。まず <code>Rakefile</code> を作ります。Mac/Linux では <code>touch</code><br>コマンドでファイルを作れます。Windows の場合は手作業で追加してください。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch Rakefile</span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'rake/testtask'</span></span><br><span class="line"></span><br><span class="line">task <span class="symbol">default:</span> [<span class="symbol">:test</span>]</span><br><span class="line"></span><br><span class="line">Rake::TestTask.new <span class="keyword">do</span> <span class="params">|test|</span></span><br><span class="line">  test.test_files = Dir[<span class="string">'./test/fizz_buzz_test.rb'</span>]</span><br><span class="line">  test.verbose = <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>タスクが登録されたか確認してみましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rake -T</span><br><span class="line">rake <span class="built_in">test</span>  <span class="comment"># Run tests</span></span><br></pre></td></tr></table></figure>

<p>タスクが登録されたことが確認できたのでタスクを実行します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ rake <span class="built_in">test</span></span><br><span class="line">/Users/k2works/.rbenv/versions/2.5.5/bin/ruby -w -I<span class="string">"lib"</span> -I<span class="string">"/Users/k2works/.rbenv/versions/2.5.5/lib/ruby/gems/2.5.0/gems/rake-13.0.1/lib"</span> <span class="string">"/Users/k2works/.rbenv/versions/2.5.5/lib/ruby/gems/2.5.0/gems/rake-13.0.1/lib/rake/rake_test_loader.rb"</span> <span class="string">"./test/fizz_buzz_test.rb"</span></span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:79: warning: method redefined; discarding old test_特定の条件を満たす要素だけを配列に入れて返す</span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:74: warning: previous definition of test_特定の条件を満たす要素だけを配列に入れて返す was here</span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:94: warning: method redefined; discarding old test_新しい要素の配列を返す</span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:89: warning: previous definition of test_新しい要素の配列を返す was here</span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:104: warning: method redefined; discarding old test_配列の中から条件に一致する要素を取得する</span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:99: warning: previous definition of test_配列の中から条件に一致する要素を取得する was here</span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:138: warning: method redefined; discarding old test_畳み込み演算を行う</span><br><span class="line">/Users/k2works/Projects/hiroshima-arc/tdd_rb/docs/src/article/code/<span class="built_in">test</span>/fizz_buzz_test.rb:133: warning: previous definition of test_畳み込み演算を行う was here</span><br><span class="line">Started with run options --seed 5886</span><br><span class="line"></span><br><span class="line">  19/19: [=======================================] 100% Time: 00:00:00, Time: 00:00:00</span><br><span class="line"></span><br><span class="line">Finished <span class="keyword">in</span> 0.00271s</span><br><span class="line">19 tests, 21 assertions, 0 failures, 0 errors, 0 skips</span><br></pre></td></tr></table></figure>

<p>テストは実施されたのですが警告メッセージが表示されるようになりました。メッセージの内容としては <strong>学習用テスト</strong> のテストメソッド名が重複していることが理由のようです。せっかくなので修正しておきましょう。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FizzBuzzTest</span> &lt; Minitest::Test</span></span><br><span class="line">  describe <span class="string">'FizzBuzz'</span> <span class="keyword">do</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">'配列や繰り返し処理を理解する'</span> <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>繰り返し処理</span></span><br><span class="line">      $stdout = StringIO.new</span><br><span class="line">      [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each &#123; <span class="params">|i|</span> p i * i &#125;</span><br><span class="line">      output = $stdout.string</span><br><span class="line"></span><br><span class="line">      assert_equal <span class="string">"1\n"</span> + <span class="string">"4\n"</span> + <span class="string">"9\n"</span>, output</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>特定の条件を満たす要素だけを配列に入れて返す</span></span><br><span class="line">      result = [<span class="number">1.1</span>, <span class="number">2</span>, <span class="number">3.3</span>, <span class="number">4</span>].select(&amp;<span class="symbol">:integer?</span>)</span><br><span class="line">      assert_equal [<span class="number">2</span>, <span class="number">4</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>特定の条件を満たす要素だけを配列に入れて返す</span></span><br><span class="line">      result = [<span class="number">1.1</span>, <span class="number">2</span>, <span class="number">3.3</span>, <span class="number">4</span>].find_all(&amp;<span class="symbol">:integer?</span>)</span><br><span class="line">      assert_equal [<span class="number">2</span>, <span class="number">4</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>特定の条件を満たさない要素だけを配列に入れて返す</span></span><br><span class="line">      result = [<span class="number">1.1</span>, <span class="number">2</span>, <span class="number">3.3</span>, <span class="number">4</span>].reject(&amp;<span class="symbol">:integer?</span>)</span><br><span class="line">      assert_equal [<span class="number">1.1</span>, <span class="number">3.3</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>新しい要素の配列を返す</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.map(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal [<span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>新しい要素の配列を返す</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.collect(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal [<span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>配列の中から条件に一致する要素を取得する</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.find(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal <span class="string">'apple'</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>配列の中から条件に一致する要素を取得する</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.detect(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal <span class="string">'apple'</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>指定した評価式で並び変えた配列を返す</span></span><br><span class="line">      result1 = <span class="string">%w[2 4 13 3 1 10]</span>.sort</span><br><span class="line">      result2 = <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|a, b|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line">      result3 = <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|b, a|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line"></span><br><span class="line">      assert_equal <span class="string">%w[1 10 13 2 3 4]</span>, result1</span><br><span class="line">      assert_equal <span class="string">%w[1 2 3 4 10 13]</span>, result2</span><br><span class="line">      assert_equal <span class="string">%w[13 10 4 3 2 1]</span>, result3</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>配列の中から条件に一致する要素を取得する</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry apricot]</span>.grep(<span class="regexp">/^a/</span>)</span><br><span class="line">      assert_equal <span class="string">%w[apple apricot]</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>ブロック内の条件式が真である間までの要素を返す</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>].take_while &#123; <span class="params">|item|</span> item &lt; <span class="number">6</span> &#125;</span><br><span class="line">      assert_equal [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>ブロック内の条件式が真である以降の要素を返す</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>].drop_while &#123; <span class="params">|item|</span> item &lt; <span class="number">6</span> &#125;</span><br><span class="line">      assert_equal [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>畳み込み演算を行う</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].inject(<span class="number">0</span>) &#123; <span class="params">|total, n|</span> total + n &#125;</span><br><span class="line">      assert_equal <span class="number">15</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>畳み込み演算を行う</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].reduce &#123; <span class="params">|total, n|</span> total + n &#125;</span><br><span class="line">      assert_equal <span class="number">15</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p><strong>メソッド名の変更</strong> を適用してリファクタリングしましょう。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FizzBuzzTest</span> &lt; Minitest::Test</span></span><br><span class="line">  describe <span class="string">'FizzBuzz'</span> <span class="keyword">do</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">'配列や繰り返し処理を理解する'</span> <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>繰り返し処理</span></span><br><span class="line">      $stdout = StringIO.new</span><br><span class="line">      [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each &#123; <span class="params">|i|</span> p i * i &#125;</span><br><span class="line">      output = $stdout.string</span><br><span class="line"></span><br><span class="line">      assert_equal <span class="string">"1\n"</span> + <span class="string">"4\n"</span> + <span class="string">"9\n"</span>, output</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_select</span>メソッドで特定の条件を満たす要素だけを配列に入れて返す</span></span><br><span class="line">      result = [<span class="number">1.1</span>, <span class="number">2</span>, <span class="number">3.3</span>, <span class="number">4</span>].select(&amp;<span class="symbol">:integer?</span>)</span><br><span class="line">      assert_equal [<span class="number">2</span>, <span class="number">4</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_find_all</span>メソッドで特定の条件を満たす要素だけを配列に入れて返す</span></span><br><span class="line">      result = [<span class="number">1.1</span>, <span class="number">2</span>, <span class="number">3.3</span>, <span class="number">4</span>].find_all(&amp;<span class="symbol">:integer?</span>)</span><br><span class="line">      assert_equal [<span class="number">2</span>, <span class="number">4</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>特定の条件を満たさない要素だけを配列に入れて返す</span></span><br><span class="line">      result = [<span class="number">1.1</span>, <span class="number">2</span>, <span class="number">3.3</span>, <span class="number">4</span>].reject(&amp;<span class="symbol">:integer?</span>)</span><br><span class="line">      assert_equal [<span class="number">1.1</span>, <span class="number">3.3</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_map</span>メソッドで新しい要素の配列を返す</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.map(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal [<span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_collect</span>メソッドで新しい要素の配列を返す</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.collect(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal [<span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_find</span>メソッドで配列の中から条件に一致する要素を取得する</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.find(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal <span class="string">'apple'</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_detect</span>メソッドで配列の中から条件に一致する要素を取得する</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry]</span>.detect(&amp;<span class="symbol">:size</span>)</span><br><span class="line">      assert_equal <span class="string">'apple'</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>指定した評価式で並び変えた配列を返す</span></span><br><span class="line">      result1 = <span class="string">%w[2 4 13 3 1 10]</span>.sort</span><br><span class="line">      result2 = <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|a, b|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line">      result3 = <span class="string">%w[2 4 13 3 1 10]</span>.sort &#123; <span class="params">|b, a|</span> a.to_i &lt;=&gt; b.to_i &#125;</span><br><span class="line"></span><br><span class="line">      assert_equal <span class="string">%w[1 10 13 2 3 4]</span>, result1</span><br><span class="line">      assert_equal <span class="string">%w[1 2 3 4 10 13]</span>, result2</span><br><span class="line">      assert_equal <span class="string">%w[13 10 4 3 2 1]</span>, result3</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>配列の中から条件に一致する要素を取得する</span></span><br><span class="line">      result = <span class="string">%w[apple orange pineapple strawberry apricot]</span>.grep(<span class="regexp">/^a/</span>)</span><br><span class="line">      assert_equal <span class="string">%w[apple apricot]</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>ブロック内の条件式が真である間までの要素を返す</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>].take_while &#123; <span class="params">|item|</span> item &lt; <span class="number">6</span> &#125;</span><br><span class="line">      assert_equal [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_</span>ブロック内の条件式が真である以降の要素を返す</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>].drop_while &#123; <span class="params">|item|</span> item &lt; <span class="number">6</span> &#125;</span><br><span class="line">      assert_equal [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>], result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_inject</span>メソッドで畳み込み演算を行う</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].inject(<span class="number">0</span>) &#123; <span class="params">|total, n|</span> total + n &#125;</span><br><span class="line">      assert_equal <span class="number">15</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_reduce</span>メソッドで畳み込み演算を行う</span></span><br><span class="line">      result = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].reduce &#123; <span class="params">|total, n|</span> total + n &#125;</span><br><span class="line">      assert_equal <span class="number">15</span>, result</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>テストを再実行して警告メッセージが消えたこと確認します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ rake <span class="built_in">test</span></span><br><span class="line">/home/gitpod/.rvm/rubies/ruby-2.6.3/bin/ruby -w -I<span class="string">"lib"</span> -I<span class="string">"/home/gitpod/.rvm/rubies/ruby-2.6.3/lib/ruby/gems/2.6.0/gems/rake-12.3.2/lib"</span> <span class="string">"/home/gitpod/.rvm/rubies/ruby-2.6.3/lib/ruby/gems/2.6.0/gems/rake-12.3.2/lib/rake/rake_test_loader.rb"</span> <span class="string">"./test/fizz_buzz_test.rb"</span></span><br><span class="line">Started with run options --seed 10674</span><br><span class="line"></span><br><span class="line">  24/24: [=========================================] 100% Time: 00:00:00, Time: 00:00:00</span><br><span class="line"></span><br><span class="line">Finished <span class="keyword">in</span> 0.00396s</span><br><span class="line">24 tests, 26 assertions, 0 failures, 0 errors, 0 skips</span><br></pre></td></tr></table></figure>

<p>テストタスクが実行されたことが確認できたので引き続き静的コードの解析タスクを追加します。こちらも開発元がタスクを用意しているのでそちらを使うことにします。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'rake/testtask'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'rubocop/rake_task'</span></span><br><span class="line">RuboCop::RakeTask.new</span><br><span class="line"></span><br><span class="line">task <span class="symbol">default:</span> [<span class="symbol">:test</span>]</span><br><span class="line"></span><br><span class="line">Rake::TestTask.new <span class="keyword">do</span> <span class="params">|test|</span></span><br><span class="line">  test.test_files = Dir[<span class="string">'./test/fizz_buzz_test.rb'</span>]</span><br><span class="line">  test.verbose = <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>タスクが登録されたことを確認します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ rake -T</span><br><span class="line">rake rubocop               <span class="comment"># Run RuboCop</span></span><br><span class="line">rake rubocop:auto_correct  <span class="comment"># Auto-correct RuboCop offenses</span></span><br><span class="line">rake <span class="built_in">test</span>                  <span class="comment"># Run tests</span></span><br></pre></td></tr></table></figure>

<p>続いてタスクを実行してみましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ rake rubocop</span><br><span class="line">Running RuboCop...</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.C..C</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line">Rakefile:1:1: C: Style/FrozenStringLiteralComment: Missing magic comment <span class="comment"># frozen_string_literal: true.</span></span><br><span class="line">require <span class="string">'rake/testtask'</span></span><br><span class="line">^</span><br><span class="line">Rakefile:10:4: C: Layout/TrailingEmptyLines: Final newline missing.</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>/fizz_buzz_test.rb:2:1: C: Layout/EmptyLineAfterMagicComment: Add an empty line after magic comments.</span><br><span class="line">require <span class="string">'simplecov'</span></span><br><span class="line">^</span><br><span class="line"><span class="built_in">test</span>/fizz_buzz_test.rb:148:6: C: Layout/TrailingWhitespace: Trailing whitespace detected.</span><br><span class="line">  end</span><br><span class="line">     ^^</span><br><span class="line"></span><br><span class="line">5 files inspected,</span><br></pre></td></tr></table></figure>

<p>いろいろ出てきましたので自動修正しましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ rake rubocop:auto_correct</span><br><span class="line">Running RuboCop...</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.C..C</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line">Rakefile:1:1: C: [Corrected] Style/FrozenStringLiteralComment: Missing magic comment <span class="comment"># frozen_string_literal: true.</span></span><br><span class="line">require <span class="string">'rake/testtask'</span></span><br><span class="line">^</span><br><span class="line">Rakefile:2:1: C: [Corrected] Layout/EmptyLineAfterMagicComment: Add an empty line after magic comments.</span><br><span class="line">require <span class="string">'rake/testtask'</span></span><br><span class="line">^</span><br><span class="line">Rakefile:10:4: C: [Corrected] Layout/TrailingEmptyLines: Final newline missing.</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>/fizz_buzz_test.rb:2:1: C: [Corrected] Layout/EmptyLineAfterMagicComment: Add an empty line after magic comments.</span><br><span class="line">require <span class="string">'simplecov'</span></span><br><span class="line">^</span><br><span class="line"><span class="built_in">test</span>/fizz_buzz_test.rb:148:6: C: [Corrected] Layout/TrailingWhitespace: Trailing whitespace detected.</span><br><span class="line">  end</span><br><span class="line">     ^^</span><br><span class="line"></span><br><span class="line">5 files inspected, 5 offenses detected, 5 offenses corrected</span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ rake rubocop</span><br><span class="line">Running RuboCop...</span><br><span class="line">Inspecting <span class="number">5</span> files</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> files inspected, no offenses detected</span><br></pre></td></tr></table></figure>

<p>うまく修正されたようですね。後、フォーマットコマンドもタスクとして追加しておきましょう。こちらは開発元が用意していないタスクなので以下のように追加します。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'rake/testtask'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'rubocop/rake_task'</span></span><br><span class="line">RuboCop::RakeTask.new</span><br><span class="line"></span><br><span class="line">task <span class="symbol">default:</span> [<span class="symbol">:test</span>]</span><br><span class="line"></span><br><span class="line">Rake::TestTask.new <span class="keyword">do</span> <span class="params">|test|</span></span><br><span class="line">  test.test_files = Dir[<span class="string">'./test/fizz_buzz_test.rb'</span>]</span><br><span class="line">  test.verbose = <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">desc <span class="string">"Run Format"</span></span><br><span class="line">task <span class="symbol">:format</span> <span class="keyword">do</span></span><br><span class="line">  sh <span class="string">"rubocop --fix-layout"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rake -T</span><br><span class="line">rake format                <span class="comment"># Run Format</span></span><br><span class="line">rake rubocop               <span class="comment"># Run RuboCop</span></span><br><span class="line">rake rubocop:auto_correct  <span class="comment"># Auto-correct RuboCop offenses</span></span><br><span class="line">rake <span class="built_in">test</span>                  <span class="comment"># Run tests</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ rake format</span><br><span class="line">rubocop --fix-layout</span><br><span class="line">Inspecting 5 files</span><br><span class="line">.C...</span><br><span class="line"></span><br><span class="line">Offenses:</span><br><span class="line"></span><br><span class="line">Rakefile:17:4: C: [Corrected] Layout/TrailingEmptyLines: Final newline missing.</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5 files inspected, 1 offense detected, 1 offense corrected</span><br></pre></td></tr></table></figure>

<p>フォーマットは <code>rake rubocop:auto_correct</code> で一緒にやってくれるので特に必要は無いのですがプログラムの開発元が提供していないタスクを作りたい場合はこのように追加します。セットアップができたのでコミットしておきましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">'chore: タスクランナーセットアップ'</span></span><br></pre></td></tr></table></figure>

<h3 id="タスクの自動化"><a href="#タスクの自動化" class="headerlink" title="タスクの自動化"></a>タスクの自動化</h3><p>良いコードを書くためのタスクをまとめることができました。でも、どうせなら自動で実行できるようにしたいですよね。タスクを自動実行するための gem を追加します。<a href="https://github.com/guard/guard" target="_blank" rel="noopener">Guard</a>とそのプラグインの <a href="https://github.com/guard/guard-shell" target="_blank" rel="noopener">Guard::Shell</a> <a href="https://github.com/guard/guard-minitest" target="_blank" rel="noopener">Guard::Minitest</a> <a href="https://github.com/yujinakayama/guard-rubocop" target="_blank" rel="noopener">guard-rubocop</a> をインストールします。それぞれの詳細は以下を参照してください。</p>
<ul>
<li><p><a href="https://qiita.com/tbpgr/items/f5be21d8e19dd852d9b7" target="_blank" rel="noopener">Ruby | Guard gem<br>を利用してファイルの変更を検出し、任意のタスクを自動実行する</a></p>
</li>
<li><p><a href="https://qiita.com/emergent/items/0a38909206844265e0b5" target="_blank" rel="noopener">guard-shell でソースコードの変更を監視して自動で make＆実行させる</a></p>
</li>
<li><p><a href="https://forest-valley17.hatenablog.com/entry/2018/10/05/183521" target="_blank" rel="noopener">Rails -<br>Guard を使い、ファイル変更時に Minitest や Rspec を自動実行する</a></p>
</li>
</ul>
<!-- end list -->

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"></span><br><span class="line">source <span class="string">'https://rubygems.org'</span></span><br><span class="line"></span><br><span class="line">git_source(<span class="symbol">:github</span>) &#123; <span class="params">|repo_name|</span> <span class="string">"https://github.com/<span class="subst">#&#123;repo_name&#125;</span>"</span> &#125;</span><br><span class="line"></span><br><span class="line">gem <span class="string">'guard'</span></span><br><span class="line">gem <span class="string">'guard-minitest'</span></span><br><span class="line">gem <span class="string">'guard-rubocop'</span></span><br><span class="line">gem <span class="string">'guard-shell'</span></span><br><span class="line">gem <span class="string">'minitest'</span></span><br><span class="line">gem <span class="string">'minitest-reporters'</span></span><br><span class="line">gem <span class="string">'rake'</span></span><br><span class="line">gem <span class="string">'rubocop'</span>, <span class="symbol">require:</span> <span class="literal">false</span></span><br><span class="line">gem <span class="string">'simplecov'</span>, <span class="symbol">require:</span> <span class="literal">false</span>, <span class="symbol">group:</span> <span class="symbol">:test</span></span><br></pre></td></tr></table></figure>

<p><code>bundle install</code> は <code>bundle</code> に省略できます。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bundle</span><br><span class="line">$ guard init</span><br></pre></td></tr></table></figure>

<p><code>Guardfile</code> が生成されるので以下の内容に変更します。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add files and commands to this file, like the example:</span></span><br><span class="line"><span class="comment">#   watch(%r&#123;file/path&#125;) &#123; `command(s)` &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">guard <span class="symbol">:shell</span> <span class="keyword">do</span></span><br><span class="line">  watch(<span class="regexp">%r&#123;lib/(.*).rb&#125;</span>) &#123; <span class="params">|_m|</span> <span class="string">`rake test`</span> &#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">guard <span class="symbol">:minitest</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># with Minitest::Unit</span></span><br><span class="line">  watch(<span class="regexp">%r&#123;test\/*.rb&#125;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">guard <span class="symbol">:rubocop</span>, <span class="symbol">cli:</span> <span class="string">%w[--auto-correct --format fuubar --format html -o ./tmp/rubocop_results.html]</span> <span class="keyword">do</span></span><br><span class="line">  watch(<span class="regexp">/(.*).rb/</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p><code>guard</code> が起動するか確認して一旦終了します。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ guard start</span><br><span class="line">Warning: the running version of Bundler (2.1.3) is older than the version that created the lockfile (2.1.4). We suggest you to upgrade to the version that created the lockfile by running `gem install bundler:2.1.4`.</span><br><span class="line">03:49:28 - INFO - Guard::Minitest 2.4.6 is running, with Minitest::Unit 5.14.0!</span><br><span class="line">03:49:28 - INFO - Running: all tests</span><br><span class="line">Coverage report generated <span class="keyword">for</span> MiniTest to /workspace/tdd_rb/coverage. 4 / 11 LOC (36.36%) covered.</span><br><span class="line">Started with run options --guard --seed 1256</span><br><span class="line"></span><br><span class="line">  24/24: [=================================================================] 100% Time: 00:00:00, Time: 00:00:00</span><br><span class="line"></span><br><span class="line">Finished <span class="keyword">in</span> 0.00363s</span><br><span class="line">24 tests, 26 assertions, 0 failures, 0 errors, 0 skips</span><br><span class="line"></span><br><span class="line">03:49:28 - INFO - Inspecting Ruby code style of all files</span><br><span class="line">Gemfile:15:46: C: [Corrected] Layout/TrailingEmptyLines: Final newline missing.</span><br><span class="line">gem <span class="string">'simplecov'</span>, require: <span class="literal">false</span>, group: :<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">Guardfile:17:4: C: [Corrected] Layout/TrailingEmptyLines: Final newline missing.</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"> 7/7 files |====================================== 100 =======================================&gt;| Time: 00:00:00</span><br><span class="line"></span><br><span class="line">7 files inspected, 2 offenses detected, 2 offenses corrected</span><br><span class="line">03:49:30 - INFO - Guard is now watching at <span class="string">'/workspace/tdd_rb'</span></span><br><span class="line">[1] guard(main)&gt; <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">03:50:31 - INFO - Bye <span class="built_in">bye</span>...</span><br></pre></td></tr></table></figure>

<p>続いて <code>Rakefile</code> に guard タスクを追加します。あと、guard タスクをデフォルトにして <code>rake</code> を実行すると呼び出されるようにしておきます。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frozen_string_literal: true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'rake/testtask'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'rubocop/rake_task'</span></span><br><span class="line">RuboCop::RakeTask.new</span><br><span class="line"></span><br><span class="line">task <span class="symbol">default:</span> [<span class="symbol">:guard</span>]</span><br><span class="line"></span><br><span class="line">Rake::TestTask.new <span class="keyword">do</span> <span class="params">|test|</span></span><br><span class="line">  test.test_files = Dir[<span class="string">'./test/fizz_buzz_test.rb'</span>]</span><br><span class="line">  test.verbose = <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">desc <span class="string">'Run Format'</span></span><br><span class="line">task <span class="symbol">:format</span> <span class="keyword">do</span></span><br><span class="line">  sh <span class="string">'rubocop --fix-layout'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">desc <span class="string">'Run Guard'</span></span><br><span class="line">task <span class="symbol">:guard</span> <span class="keyword">do</span></span><br><span class="line">  sh <span class="string">'guard start'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>自動実行タスクを起動しましょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ rake</span><br><span class="line">guard start</span><br><span class="line">03:52:01 - INFO - Guard::Minitest 2.4.6 is running, with Minitest::Unit 5.14.0!</span><br><span class="line">03:52:01 - INFO - Running: all tests</span><br><span class="line">Coverage report generated <span class="keyword">for</span> MiniTest to /workspace/tdd_rb/coverage. 4 / 11 LOC (36.36%) covered.</span><br><span class="line">Started with run options --guard --seed 3219</span><br><span class="line"></span><br><span class="line">  24/24: [=================================================================] 100% Time: 00:00:00, Time: 00:00:00</span><br><span class="line"></span><br><span class="line">Finished <span class="keyword">in</span> 0.00844s</span><br><span class="line">24 tests, 26 assertions, 0 failures, 0 errors, 0 skips</span><br><span class="line"></span><br><span class="line">03:52:01 - INFO - Inspecting Ruby code style of all files</span><br><span class="line"> 7/7 files |====================================== 100 =======================================&gt;| Time: 00:00:00</span><br><span class="line"></span><br><span class="line">7 files inspected, no offenses detected</span><br><span class="line">03:52:03 - INFO - Guard is now watching at <span class="string">'/workspace/tdd_rb'</span></span><br><span class="line">[1] guard(main)&gt;</span><br></pre></td></tr></table></figure>

<p>起動したら <code>fizz_buzz_test.rb</code> を編集してテストが自動実行されるか確認しましょう。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FizzBuzzTest</span> &lt; Minitest::Test</span></span><br><span class="line">  describe <span class="string">'FizzBuzz'</span> <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span></span></span><br><span class="line">      @fizzbuzz = FizzBuzz</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    describe <span class="string">'三の倍数の場合'</span> <span class="keyword">do</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">test_3</span>を渡したら文字列<span class="title">Fizz</span>を返す</span></span><br><span class="line">        assert_equal <span class="string">'FizzFizz'</span>, @fizzbuzz.generate(<span class="number">3</span>)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">05:00:34 - INFO - Running: all tests</span><br><span class="line">Coverage report generated <span class="keyword">for</span> MiniTest to /workspace/tdd_rb/coverage. 4 / 11 LOC (36.36%) covered.</span><br><span class="line">Started with run options --guard --seed 16292</span><br><span class="line"></span><br><span class="line"> FAIL[<span class="string">"test_3を渡したら文字列Fizzを返す"</span>, <span class="comment">#&lt;Minitest::Reporters::Suite:0x000055640e99f080 @name="FizzBuzz::三の倍数の場合"&gt;, 0.005698626991943456]</span></span><br><span class="line"> test_3を渡したら文字列Fizzを返す<span class="comment">#FizzBuzz::三の倍数の場合 (0.01s)</span></span><br><span class="line">        Expected: <span class="string">"FizzFizz"</span></span><br><span class="line">          Actual: <span class="string">"Fizz"</span></span><br><span class="line">        /workspace/tdd_rb/<span class="built_in">test</span>/fizz_buzz_test.rb:18:<span class="keyword">in</span> `test_3を渡したら文字列Fizzを返す<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  24/24: [=================================================================] 100% Time: 00:00:00, Time: 00:00:00</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Finished in 0.00742s</span></span><br><span class="line"><span class="string">24 tests, 26 assertions, 1 failures, 0 errors, 0 skips</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">05:00:35 - INFO - Inspecting Ruby code style: test/fizz_buzz_test.rb</span></span><br><span class="line"><span class="string"> 1/1 file |======================================= 100 =======================================&gt;| Time: 00:00:00</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1 file inspected, no offenses detected</span></span><br><span class="line"><span class="string">05:00:36 - INFO - Inspecting Ruby code style: coverage/assets/0.10.2/colorbox/border.png coverage/assets/0.10.2/colorbox/loading_background.png coverage/assets/0.10.2/colorbox/loading.gif coverage/assets/0.10.2/colorbox/controls.png</span></span><br><span class="line"><span class="string"> 0/0 files |====================================== 100 =======================================&gt;| Time: 00:00:00</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0 files inspected, no offenses detected</span></span><br><span class="line"><span class="string">[1] guard(main)&gt;</span></span><br></pre></td></tr></table></figure>

<p>変更を感知してテストが実行されるた結果失敗していましました。コードを元に戻してテストをパスするようにしておきましょう。テストがパスすることが確認できたらコミットしておきましょう。このときターミナルでは <code>guard</code> が動いているので別ターミナルを開いてコミットを実施すると良いでしょう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">'chore: タスクの自動化'</span></span><br></pre></td></tr></table></figure>

<p>これで <a href="https://t-wada.hatenablog.jp/entry/clean-code-that-works" target="_blank" rel="noopener">ソフトウェア開発の三種の神器</a> の最後のアイテムの準備ができました。次回の開発からは最初にコマンドラインで <code>rake</code> を実行すれば良いコードを書くためのタスクを自動でやってくるようになるのでコードを書くことに集中できるようになりました。では、次のエピソードに進むとしましょう。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">k2works</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://k2works.github.io/2020/04/17/1587440287/">https://k2works.github.io/2020/04/17/1587440287/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA/">テスト駆動開発</a><a class="post-meta__tags" href="/tags/Ruby/">Ruby</a></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e9e7853f8eb0c4e" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/04/18/1587440576/"><i class="fa fa-chevron-left">  </i><span>テスト駆動開発から始めるRuby入門 ~アルゴリズムのパフォーマンスチューニングとベンチマークを実践する~</span></a></div><div class="next-post pull-right"><a href="/2020/04/16/1587009564/"><span>テスト駆動開発から始めるRuby入門 ~2時間でTDDとリファクタリングのエッセンスを体験する~</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By k2works</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>